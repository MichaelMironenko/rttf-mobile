include /components/block.pug
include /components/atoms/avatar.pug
include /components/reactions.pug
include /components/atoms/userRating.pug
include /components/atoms/starRating.pug
include /components/atoms/userStatusBadge.pug
include /components/comment.pug

mixin comments(isReview = false)
  +block(isReview ? "3 –æ—Ç–∑—ã–≤–∞" : "3 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è", '', '', false)
    #comments.flex.items-center.gap-3.pb-3
      +avatar('bg-lab-blue', '–ù–ü', '32')

      .relative.flex.flex-grow.flex-col.gap-3
        if isReview
          .flex.items-center.justify-end.gap-3(class='430:ml-4 430:justify-start')
            span.text-sm.text-lab-black-50 –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞
            +starRating(0)
        textarea#commentTextArea.hidden.resize-none.overflow-hidden.rounded-md.border.border-gray-300.p-2.transition-all.duration-300.ease-in-out(
          ,
          class='focus:border-blue-500 focus:outline-none',
          style='scrollbar-width: none; -ms-overflow-style: none',
          rows='1',
          placeholder='–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)...'
        )

        .flex.hidden.items-center.gap-4
          img#pasteButton.size-6(src='img/paste.svg', alt='–í—Å—Ç–∞–≤–∏—Ç—å')
          +button('–û—Ç–º–µ–Ω–∞', 'text', 'lab-black-50', '', 'w-1/2', 'cancelButton')
          +button('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', 'default', 'white', 'bg-lab-color', 'w-1/2', 'commentSubmitButton')

      script.
        const textArea = document.getElementById('commentTextArea')
        const submitButton = document.getElementById('commentSubmitButton')
        const cancelButton = document.getElementById('cancelButton')
        const pasteButton = document.getElementById('pasteButton')
        const starContainer = document.querySelector('#comments .flex.items-center.justify-end.gap-3')
        const buttonContainer = document.querySelector('#comments .flex.items-center.gap-4')

        function showElements() {
          textArea.classList.remove('hidden')
          buttonContainer.classList.remove('hidden')
          submitButton.classList.remove('hidden')
          cancelButton.classList.remove('hidden')
          pasteButton.classList.remove('hidden')
          submitButton.disabled = true
        }

        textArea.addEventListener('focus', function () {
          this.rows = 3
          this.style.overflow = 'hidden'
          showElements()
        })

        textArea.addEventListener('input', function () {
          submitButton.disabled = this.value.trim().length <= 1
          this.style.height = ''
          this.style.height = this.scrollHeight + 'px'
          if (this.value.trim().length) {
            showElements()
          } else {
            submitButton.classList.add('hidden')
            cancelButton.classList.add('hidden')
            pasteButton.classList.add('hidden')
          }
        })

        textArea.addEventListener('blur', function () {
          if (!this.value.trim()) {
            this.rows = 1
            this.style.height = 'auto'
            this.style.overflow = 'hidden'
            submitButton.classList.add('hidden')
            cancelButton.classList.add('hidden')
            pasteButton.classList.add('hidden')
          }
        })

        if (#{ isReview }) {
          const stars = document.querySelectorAll('#comments img[alt="Star"]')
          stars.forEach((star, index) => {
            star.addEventListener('click', () => {
              stars.forEach((s, i) => {
                s.src = i <= index ? 'img/yellow-star-full.svg' : 'img/yellow-star-empty.svg'
              })
              showElements()
            })
          })
        }

    +comment('1', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –°–µ–º—ë–Ω–æ–≤', 'asemenov', '', '–£ –º–µ–Ω—è —Å–ª–æ–º–∞–ª–∞—Å—å —Ä–∞–∫–µ—Ç–∫–∞, –∫—Ç–æ –º–æ–∂–µ—Ç –æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø–∞—Å–Ω—É—é? üôèüèº', isReview ? null : [ { count: 3, emoji: 'üëç' }, { count: 2, emoji: 'üëé' }, { count: 1, emoji: 'üòÇ' }, { count: 0, emoji: 'üëè' }, { count: 0, emoji: 'üò≤' }, { count: 0, emoji: 'üôèüèº' } ], 'bg-lab-green', 'dynamic-img/user-1.jpg', isReview ? 4 : null)

    .border-l.border-lab-black-10.pl-6
      +comment('2', '–ù–∏–∫–∏—Ç–∞ –ü–æ–ª—è–Ω—Å–∫–∏–π', 'nikpol', '–ê–¥–º–∏–Ω', '–£ –º–µ–Ω—è –µ—Å—Ç—å, –Ω–æ –Ω–∞ –Ω–µ–π –Ω—É–∂–Ω–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å —Å—Ç—Ä—É–Ω—ã', isReview ? null : [ { count: 2, emoji: 'üëè' }, { count: 2, emoji: 'üëç' }, { count: 1, emoji: 'üôèüèº' }, { count: 0, emoji: 'üëé' }, { count: 0, emoji: 'üòÇ' }, { count: 0, emoji: 'üò≤' }, ], 'bg-lab-blue', null, isReview ? 3 : null)
    .border-l.border-lab-black-10.pl-6
      .border-l.border-lab-black-10.pl-6
        +comment('3', '', 'asemenov', '', '–ü–æ–¥—Ç—è–Ω—É—Ç—å –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞, —Å–ø–∞—Å–∏–±–æ! –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å —Ç–æ–±–æ–π –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è?', isReview ? null :[ { count: 0, emoji: 'üëç' }, { count: 0, emoji: 'üëé' }, { count: 0, emoji: 'üòÇ' }, { count: 0, emoji: 'üëè' }, { count: 0, emoji: 'üò≤' }, { count: 0, emoji: 'üôèüèº' } ], 'bg-lab-green', 'dynamic-img/user-1.jpg', isReview ? 5 : null)
